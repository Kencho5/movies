<div
  class="fixed top-0 z-50 w-full select-none border-b border-b-white/10 bg-gradient-to-b from-bg-dark/95 to-bg-dark/60 backdrop-blur supports-[backdrop-filter]:bg-bg-dark/70"
  data-tauri-drag-region
>
  <div
    class="container relative mx-auto flex h-14 items-center justify-between px-4 md:h-[68px] md:px-8"
    data-tauri-drag-region
  >
    <!-- Logo + Nav -->
    <div class="flex h-full items-center gap-6 md:gap-10">
      <a routerLink="" class="flex-shrink-0" aria-label="Home">
        <img src="/assets/logo.svg" class="h-6 md:h-7" alt="Logo" />
      </a>

      <nav
        class="hidden items-center gap-6 md:flex"
        [class.opacity-0]="searchOpen()"
      >
        <a
          routerLink=""
          routerLinkActive="!text-white font-semibold"
          [routerLinkActiveOptions]="{ exact: true }"
          class="group text-white/80 transition-colors hover:text-white"
        >
          <span class="relative">
            {{ "SHARED.TITLEBAR.home" | transloco }}
            <span
              class="absolute -bottom-1 left-0 h-[2px] w-0 bg-red-600 transition-all duration-200 group-hover:w-full"
            ></span>
          </span>
        </a>

        <a
          routerLink="/movies"
          routerLinkActive="!text-white font-semibold"
          [routerLinkActiveOptions]="{ exact: true }"
          class="group text-white/80 transition-colors hover:text-white"
        >
          <span class="relative">
            {{ "SHARED.TITLEBAR.movies" | transloco }}
            <span
              class="absolute -bottom-1 left-0 h-[2px] w-0 bg-red-600 transition-all duration-200 group-hover:w-full"
            ></span>
          </span>
        </a>

        <a
          routerLink="/series"
          routerLinkActive="!text-white font-semibold"
          [routerLinkActiveOptions]="{ exact: true }"
          class="group text-white/80 transition-colors hover:text-white"
        >
          <span class="relative">
            {{ "SHARED.TITLEBAR.series" | transloco }}
            <span
              class="absolute -bottom-1 left-0 h-[2px] w-0 bg-red-600 transition-all duration-200 group-hover:w-full"
            ></span>
          </span>
        </a>

        <a
          routerLink="tv"
          routerLinkActive="!text-white font-semibold"
          class="group text-white/80 transition-colors hover:text-white"
        >
          <span class="relative">
            {{ "SHARED.TITLEBAR.live_tv" | transloco }}
            <span
              class="absolute -bottom-1 left-0 h-[2px] w-0 bg-red-600 transition-all duration-200 group-hover:w-full"
            ></span>
          </span>
        </a>
      </nav>
    </div>

    <!-- Right Side -->
    <div class="flex items-center gap-4 md:gap-6">
      <button
        class="group relative p-1"
        aria-label="Search"
        (click)="openSearch($event)"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          class="h-5 w-5 text-white/80 transition-colors group-hover:text-white"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          />
        </svg>
      </button>

      <app-language-selector />

      <button class="md:hidden" (click)="toggleMenu()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6 text-white/80 transition-colors hover:text-white"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16m-7 6h7"
          />
        </svg>
      </button>
    </div>

    <!-- Search Overlay -->
    <div
      class="pointer-events-none absolute left-0 top-0 h-full w-full bg-bg-dark/95 opacity-0 transition-opacity duration-300"
      [class.pointer-events-none]="!searchOpen()"
      [class.opacity-0]="!searchOpen()"
      (click)="closeSearch()"
    >
      <div
        class="container mx-auto flex h-full items-center gap-3 px-4 md:px-8"
        (click)="$event.stopPropagation()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="hidden h-5 w-5 text-white/60 md:block"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          />
        </svg>

        <input
          #searchInput
          type="text"
          [placeholder]="'SHARED.TITLEBAR.search_placeholder' | transloco"
          class="h-full w-full flex-1 bg-transparent text-base text-white placeholder-white/40 focus:outline-none md:text-lg"
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchTermChange($event)"
          autofocus
        />
        <button
          (click)="closeSearch()"
          class="p-2 text-white/70 hover:text-white"
          aria-label="Close search"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>
  <!-- Search Results -->
  @if (searchOpen() && (searchResults() !== null || loading())) {
    <div
      class="absolute left-0 top-full w-full bg-gradient-to-b from-bg-dark to-bg-dark/95 shadow-2xl"
    >
      <div
        class="container mx-auto max-h-[70vh] overflow-y-auto px-4 py-4 md:px-8"
      >
        @if (loading()) {
          <div
            class="grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"
          >
            @for (i of [].constructor(4); track $index) {
              <div class="flex items-start gap-4 rounded-lg p-2">
                <div
                  class="h-24 w-16 flex-shrink-0 animate-pulse rounded-md bg-white/10"
                ></div>
                <div class="flex-1 space-y-2 py-1">
                  <div class="h-4 animate-pulse rounded bg-white/10"></div>
                  <div
                    class="h-3 w-2/3 animate-pulse rounded bg-white/10"
                  ></div>
                </div>
              </div>
            }
          </div>
        } @else if (searchResults() && searchResults()!.length > 0) {
          <div
            class="grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"
          >
            @for (result of searchResults(); track result.id) {
              <a
                [routerLink]="['/watch', result.id]"
                class="group flex items-start gap-4 rounded-lg p-2 transition-colors hover:bg-bg-highlight/70"
                (click)="closeSearch()"
              >
                <div class="h-24 w-16 flex-shrink-0 overflow-hidden rounded-md">
                  <img
                    [src]="result.poster"
                    [alt]="result.name"
                    class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-[1.04]"
                  />
                </div>
                <div>
                  <h3 class="font-semibold text-white group-hover:text-white">
                    {{ result.name }}
                  </h3>
                  <p class="text-sm text-white/60">
                    {{
                      result.is_series
                        ? ("SHARED.TITLEBAR.series" | transloco)
                        : ("SHARED.TITLEBAR.movies" | transloco)
                    }}
                  </p>
                </div>
              </a>
            }
          </div>
        } @else if (searchQuery) {
          <div class="p-8 text-center text-white/60">
            <p>
              {{
                "SHARED.TITLEBAR.no_results" | transloco: { query: searchQuery }
              }}
            </p>
          </div>
        }
      </div>
    </div>
  }

  <!-- Mobile Menu -->
  <div
    class="absolute left-0 right-0 top-full mt-0.5 bg-bg-dark/95 px-6 py-4 transition-all duration-300 ease-in-out md:hidden"
    [ngClass]="{
      'pointer-events-none invisible -translate-y-3 opacity-0': !menuOpen(),
      'pointer-events-auto visible translate-y-0 opacity-100': menuOpen(),
    }"
  >
    <div
      class="flex flex-col space-y-5 text-base"
      [ngClass]="{
        '-translate-y-2 opacity-0': !menuOpen(),
        'translate-y-0 opacity-100': menuOpen(),
      }"
    >
      <a
        routerLink=""
        routerLinkActive="!text-white font-semibold"
        [routerLinkActiveOptions]="{ exact: true }"
        class="text-white/80 transition-colors hover:text-white"
        (click)="toggleMenu()"
        >{{ "SHARED.TITLEBAR.home" | transloco }}</a
      >
      <a
        routerLink="/movies"
        routerLinkActive="!text-white font-semibold"
        [routerLinkActiveOptions]="{ exact: true }"
        class="text-white/80 transition-colors hover:text-white"
        (click)="toggleMenu()"
        >{{ "SHARED.TITLEBAR.movies" | transloco }}</a
      >
      <a
        routerLink="/series"
        routerLinkActive="!text-white font-semibold"
        [routerLinkActiveOptions]="{ exact: true }"
        class="text-white/80 transition-colors hover:text-white"
        (click)="toggleMenu()"
        >{{ "SHARED.TITLEBAR.series" | transloco }}</a
      >
      <a
        routerLink="tv"
        routerLinkActive="!text-white font-semibold"
        [routerLinkActiveOptions]="{ exact: true }"
        class="text-white/80 transition-colors hover:text-white"
        (click)="toggleMenu()"
        >{{ "SHARED.TITLEBAR.live_tv" | transloco }}</a
      >
    </div>
  </div>
</div>
