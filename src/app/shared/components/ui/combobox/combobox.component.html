<div class="relative w-full">
  <div
    class="relative"
    (mousedown)="toggleDropdown()"
    (click)="$event.stopPropagation()"
  >
    <input
      type="text"
      [ngModel]="dropdownOpen() ? searchText() : displayValue()"
      (ngModelChange)="searchText.set($event)"
      (focus)="dropdownOpen.set(true)"
      placeholder="Search..."
      class="w-full appearance-none rounded-md border border-white/10 bg-white/5 py-2 pl-3 pr-9 text-sm text-white/80 placeholder-white/40 transition-colors focus:border-primary-600 focus:bg-bg-highlight focus:outline-none focus:ring-0"
    />
    <!-- Right icon area -->
    <div
      class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-white/60"
    >
      <!-- Chevron-down -->
      <svg
        class="h-4 w-4 transition-transform"
        viewBox="0 0 24 24"
        fill="currentColor"
      >
        <path
          d="M6.47 8.97a.75.75 0 011.06 0L12 13.44l4.47-4.47a.75.75 0 111.06 1.06l-5 5a.75.75 0 01-1.06 0l-5-5a.75.75 0 010-1.06z"
        />
      </svg>
    </div>
  </div>
  @if (dropdownOpen()) {
    <div
      class="absolute z-10 mt-1 max-h-60 w-full overflow-y-auto rounded-md border border-white/10 bg-bg-card/95 shadow-xl backdrop-blur"
    >
      @for (item of filteredItems; track item.value) {
        <div
          (click)="selectItem(item)"
          class="flex cursor-pointer items-center justify-between px-3 py-2 text-sm text-white/80 transition-colors hover:bg-white/10"
        >
          <span class="truncate">{{ item.name }}</span>
          @if (isSelected(item)) {
            <!-- Check icon -->
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4 text-primary-600"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                clip-rule="evenodd"
              />
            </svg>
          }
        </div>
      }
      @if (filteredItems.length === 0) {
        <div class="flex items-center gap-2 px-3 py-2 text-sm text-white/60">
          <!-- Search icon -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4.5 w-4.5 opacity-80"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              d="M10.5 3.75a6.75 6.75 0 014.995 11.375l3.19 3.19a.75.75 0 11-1.06 1.06l-3.19-3.19A6.75 6.75 0 1110.5 3.75zm0 1.5a5.25 5.25 0 100 10.5 5.25 5.25 0 000-10.5z"
            />
          </svg>
          {{ 'SHARED.COMBOBOX.no_results_found' | transloco }}
        </div>
      }
    </div>
  }
</div>

